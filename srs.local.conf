# SRS configuration for StreamSite local development
# Documentation: https://ossrs.net/lts/en-us/docs/v6/doc/introduction

# Listen on standard RTMP port
listen              1935;
max_connections     1000;

# Run in foreground for easier debugging
daemon              off;

# Log to console for development
srs_log_tank        console;
srs_log_level       trace;

# HTTP server for HLS delivery
http_server {
    enabled         on;
    listen          8080;
    dir             ./.srs;
}

# HTTP API for stats and management
http_api {
    enabled         on;
    listen          1985;
}

# Default virtual host configuration
vhost __defaultVhost__ {
    # HLS configuration
    hls {
        enabled         on;
        hls_path        ./.srs/streams;
        hls_fragment    2;      # 2 second segments for lower latency
        hls_window      10;     # Keep 10 segments (20 seconds of video)
        hls_cleanup     on;     # Clean up old segments
        hls_dispose     3;      # Dispose segments after 3 cycles
    }

    # HTTP callbacks for authentication
    http_hooks {
        enabled         on;
        # Validate stream key when publisher connects
        on_publish      http://127.0.0.1:3000/rpc/ValidateStreamKey;
        # Notify when stream ends
        on_unpublish    http://127.0.0.1:3000/rpc/HandleStreamUnpublish;
    }
}
